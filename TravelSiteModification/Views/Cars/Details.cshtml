@model TravelSiteModification.Models.CarDetailViewModel
@using Microsoft.AspNetCore.Http

@{
    ViewData["Title"] = "Car Details";
    var userFirstName = Context.Session.GetString("UserFirstName");
}

<div class="container py-5">
    <a asp-action="Index" class="btn btn-sm btn-outline-secondary mb-3">← Back to Search Results</a>

    <div class="mt-3 p-4 border rounded-3 bg-white shadow">
        <h2 class="text-primary mb-4">Selected Car & Agency Details</h2>

        <div class="row">
            <div class="col-md-5">
                <h3 class="fs-5 fw-bold text-dark border-bottom pb-2">
                    Car Model: @Model.CarModel
                </h3>

                <!-- CAR IMAGE GALLERY -->
                @if (Model.GalleryImages != null && Model.GalleryImages.Count > 0)
                {
                    <div id="carGallery" class="carousel slide mb-3" data-bs-ride="carousel">

                        <div class="carousel-indicators">
                            @for (int i = 0; i < Model.GalleryImages.Count; i++)
                            {
                                <button type="button"
                                        data-bs-target="#carGallery"
                                        data-bs-slide-to="@i"
                                        class="@(i == 0 ? "active" : "")">
                                </button>
                            }
                        </div>

                        <div class="carousel-inner rounded shadow-sm">
                            @for (int i = 0; i < Model.GalleryImages.Count; i++)
                            {
                                <div class="carousel-item @(i == 0 ? "active" : "")">
                                    <img src="@Model.GalleryImages[i]"
                                         class="d-block w-100 rounded"
                                         style="max-height:250px; object-fit:cover;" />
                                </div>
                            }
                        </div>

                        <button class="carousel-control-prev" type="button" data-bs-target="#carGallery" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon"></span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#carGallery" data-bs-slide="next">
                            <span class="carousel-control-next-icon"></span>
                        </button>
                    </div>
                }
                else if (!string.IsNullOrEmpty(Model.ImagePath))
                {
                    <!-- Fallback if no gallery -->
                    <img src="@Model.ImagePath"
                         class="img-fluid rounded mb-3"
                         style="max-height:200px;" />
                }

                <p><strong>Car Type:</strong> @Model.CarType</p>
                <p><strong>Price/Day:</strong> @Model.PricePerDay.ToString("C")</p>
                <p><strong>Car ID:</strong> @Model.CarID</p>

                <h5 class="mt-4">Final Booking</h5>
                <a asp-controller="CarBooking"
                   asp-action="Index"
                   class="btn btn-success btn-lg w-100">
                    Book This Car
                </a>
            </div>

            <div class="col-md-7">
                <h3 class="fs-5 fw-bold text-dark border-bottom pb-2 mt-4 mt-md-0">
                    Rental Agency Information
                </h3>

                <p><strong>Agency:</strong> @Model.AgencyName</p>
                <p><strong>Phone:</strong> @Model.AgencyPhone</p>
                <p><strong>Email:</strong> @Model.AgencyEmail</p>

                <h3 class="fs-5 fw-bold text-dark mt-4 border-bottom pb-2">
                    Other Available Cars from this Agency
                </h3>

                @if (Model.OtherAgencyCars != null && Model.OtherAgencyCars.Count > 0)
                {
                    <table class="table table-striped table-sm">
                        <thead class="table-secondary">
                            <tr>
                                <th>Model</th>
                                <th>Type</th>
                                <th class="text-end">Price/Day</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var car in Model.OtherAgencyCars)
                            {
                                <tr>
                                    <td>@car.CarModel</td>
                                    <td>@car.CarType</td>
                                    <td class="text-end">@car.PricePerDay.ToString("C")</td>
                                    <td>
                                        <a asp-action="Details"
                                           asp-route-carId="@car.CarID"
                                           asp-route-agencyId="@car.AgencyID"
                                           class="btn btn-outline-info btn-sm">
                                            View Details
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
                else
                {
                    <p class="text-muted">No other available cars from this agency.</p>
                }
            </div>
        </div>
    </div>
</div>
