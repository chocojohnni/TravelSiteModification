@model TravelSiteModification.Models.HotelDetailsViewModel
@{
    ViewData["Title"] = "Hotel Details";
}

<div class="container py-5">
    <a asp-action="Index" class="btn btn-sm btn-outline-secondary mb-3">
        &larr; Back to Search Results
    </a>

    <div class="row">
        <!-- LEFT COLUMN: Hotel Info -->
        <div class="col-md-4">
            <h2 class="fw-bold text-primary">@Model.HotelName</h2>

            @if (Model.GalleryImages != null && Model.GalleryImages.Count > 0)
            {
                <div id="hotelGallery" class="carousel slide mb-3" data-bs-ride="carousel">

                    <div class="carousel-indicators">
                        @for (int i = 0; i < Model.GalleryImages.Count; i++)
                        {
                            <button type="button"
                                    data-bs-target="#hotelGallery"
                                    data-bs-slide-to="@i"
                                    class="@(i == 0 ? "active" : "")">
                            </button>
                        }
                    </div>

                    <div class="carousel-inner rounded shadow-sm">
                        @for (int i = 0; i < Model.GalleryImages.Count; i++)
                        {
                            <div class="carousel-item @(i == 0 ? "active" : "")">
                                <img src="@Model.GalleryImages[i]"
                                     class="d-block w-100 rounded"
                                     style="max-height:300px; object-fit:cover;" />
                            </div>
                        }
                    </div>

                    <button class="carousel-control-prev" type="button" data-bs-target="#hotelGallery" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon"></span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#hotelGallery" data-bs-slide="next">
                        <span class="carousel-control-next-icon"></span>
                    </button>

                </div>
            }
            else if (!string.IsNullOrEmpty(Model.ImagePath))
            {
                <img src="@Model.ImagePath" class="img-fluid rounded mb-3" />
            }

            <h5 class="mt-4">Contact &amp; Location</h5>
            <p class="mb-0"><strong>Address:</strong> @Model.Address</p>
            <p class="mb-0"><strong>Phone:</strong> @Model.Phone</p>
            <p class="mb-0"><strong>Email:</strong> @Model.Email</p>

            @if (!string.IsNullOrEmpty(Model.Description))
            {
                <p class="mt-3">@Model.Description</p>
            }

            @if (Model.CheckInDate.HasValue || Model.CheckOutDate.HasValue)
            {
                <div class="mt-3">
                    <h6 class="fw-bold">Your Dates</h6>

                    @if (Model.CheckInDate.HasValue)
                    {
                        <p class="mb-0"><strong>Check-in:</strong> @Model.CheckInDate.Value.ToShortDateString()</p>
                    }
                    @if (Model.CheckOutDate.HasValue)
                    {
                        <p class="mb-0"><strong>Check-out:</strong> @Model.CheckOutDate.Value.ToShortDateString()</p>
                    }
                </div>
            }
        </div>



        <!-- RIGHT COLUMN: Rooms -->
        <div class="col-md-8">
            <h3 class="border-bottom pb-2">Available Rooms</h3>

            @if (Model.Rooms != null && Model.Rooms.Count > 0)
            {
                <table class="table table-sm table-hover">
                    <thead>
                        <tr>
                            <th>Room Type</th>
                            <th class="text-center">Capacity</th>
                            <th class="text-end">Nightly Price</th>
                            <th>Select</th>
                        </tr>
                    </thead>

                    <tbody>
                        @foreach (var room in Model.Rooms)
                        {
                            <tr>
                                <!-- Room Info -->
                                <td>
                                    <div class="d-flex align-items-center">
                                        @if (!string.IsNullOrEmpty(room.ImagePath))
                                        {
                                            <img src="@room.ImagePath"
                                                 height="50" width="80"
                                                 class="me-2 rounded" />
                                        }
                                        <span class="fw-semibold">@room.RoomType</span>
                                    </div>
                                </td>

                                <td class="text-center">@room.Capacity</td>
                                <td class="text-end">@room.Price.ToString("C")</td>

                                <!-- THE FIXED SELECT BUTTON -->
                                <td>
                                    <!-- Button submits a form OUTSIDE the table -->
                                    <button type="submit"
                                            form="selectForm_@room.RoomID"
                                            class="btn btn-primary btn-sm">
                                        Select
                                    </button>

                                    <!-- FORM OUTSIDE TABLE -->
                                    <form id="selectForm_@room.RoomID"
                                          method="post"
                                          action="/HotelBooking/SelectRoom">

                                        <input type="hidden" name="hotelId" value="@Model.HotelID" />
                                        <input type="hidden" name="roomId" value="@room.RoomID" />

                                        <input type="hidden" name="checkInDate"
                                               value="@Model.CheckInDate?.ToString("yyyy-MM-dd")" />
                                        <input type="hidden" name="checkOutDate"
                                               value="@Model.CheckOutDate?.ToString("yyyy-MM-dd")" />

                                    </form>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p class="alert alert-info">No rooms are available for your selected dates.</p>
            }
        </div>
    </div>
</div>
